<!DOCTYPE html><!--S9VwBvixHK3qfKMKpMISo--><html lang="en" class="geistmono_157ca88a-module__TXdLRq__variable"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/GeistMono_Variable.p.73882635.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/chunks/59edfdd82909e7e2.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/1e4a5921a7142076.js"/><script src="/_next/static/chunks/142337fd25442fe6.js" async=""></script><script src="/_next/static/chunks/6b3656f8df3a86fe.js" async=""></script><script src="/_next/static/chunks/406ec2b483ec95d1.js" async=""></script><script src="/_next/static/chunks/turbopack-39b30a5232e347ce.js" async=""></script><script src="/_next/static/chunks/7a1cc90d8d7c91eb.js" async=""></script><script src="/_next/static/chunks/1ca67093247280ae.js" async=""></script><script src="/_next/static/chunks/fec5ea6183d0e55b.js" async=""></script><script src="/_next/static/chunks/3b60e5197848a126.js" async=""></script><link rel="preload" href="https://cloud.umami.is/script.js" as="script"/><title>Keon Kim</title><meta name="description" content="Keon&#x27;s blog."/><link rel="manifest" href="/favicon/site.webmanifest"/><meta name="robots" content="index, follow"/><meta name="googlebot" content="index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1"/><meta property="og:title" content="Keon Kim"/><meta property="og:description" content="Keon&#x27;s blog."/><meta property="og:url" content="https://keon.github.io/"/><meta property="og:site_name" content="Keon Kim"/><meta property="og:locale" content="en_US"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Keon Kim"/><meta name="twitter:description" content="Keon&#x27;s blog."/><link rel="icon" href="/favicon/favicon-16x16.png" sizes="16x16" type="image/png"/><link rel="icon" href="/favicon/favicon-32x32.png" sizes="32x32" type="image/png"/><link rel="icon" href="/favicon/favicon.ico" sizes="any"/><link rel="apple-touch-icon" href="/favicon/apple-touch-icon.png" sizes="180x180" type="image/png"/><link rel="android-chrome-192x192" href="/favicon/android-chrome-192x192.png"/><link rel="android-chrome-512x512" href="/favicon/android-chrome-512x512.png"/><script src="/_next/static/chunks/a6dad97d9634a72d.js" noModule=""></script></head><body class="font-mono antialiased max-w-2xl mx-4 mt-6 lg:mx-auto text-sm text-black bg-white dark:text-white dark:bg-black"><div hidden=""><!--$--><!--/$--></div><script>((a,b,c,d,e,f,g,h)=>{let i=document.documentElement,j=["light","dark"];function k(b){var c;(Array.isArray(a)?a:[a]).forEach(a=>{let c="class"===a,d=c&&f?e.map(a=>f[a]||a):e;c?(i.classList.remove(...d),i.classList.add(f&&f[b]?f[b]:b)):i.setAttribute(a,b)}),c=b,h&&j.includes(c)&&(i.style.colorScheme=c)}if(d)k(d);else try{let a=localStorage.getItem(b)||c,d=g&&"system"===a?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":a;k(d)}catch(a){}})("class","theme","system",null,["light","dark"],null,true,true)</script><main class="flex-auto min-w-0 mt-4 flex flex-col px-2 md:px-0"><aside class="-ml-[8px] mb-8 tracking-tight"><div class="lg:sticky lg:top-20"><nav class="flex flex-row items-center justify-between relative px-0 pb-0 fade md:overflow-auto scroll-pr-6 md:relative" id="nav"><div class="flex flex-row space-x-0 pr-10"><a class="transition-all hover:bg-black hover:text-white dark:hover:bg-white dark:hover:text-black flex align-middle relative py-1 px-2 m-1" href="/">home</a><a class="transition-all hover:bg-black hover:text-white dark:hover:bg-white dark:hover:text-black flex align-middle relative py-1 px-2 m-1" href="/writing/">writing</a></div></nav></div></aside><section><h1 class="title font-bold text-lg">Rules of Thumb for MongoDB Schema Design</h1><div class="flex justify-between items-center mt-1 mb-6 text-xs"><span class="relative group cursor-default inline-flex items-center"><span class="absolute bottom-full left-0 mb-1 px-2 py-1 text-[10px] bg-black text-white dark:bg-white dark:text-black invisible group-hover:visible transition-all pointer-events-none whitespace-nowrap">Jan 11, 2017, 24:00<br/>Jan 11, 2017, 24:00<!-- --> GMT</span></span></div><article class="prose"><p>This is a summary of <a target="_blank" rel="noopener noreferrer" href="https://www.mongodb.com/blog/post/6-rules-of-thumb-for-mongodb-schema-design-part-1">6 Rules of Thumb for MongoDB Schema Design</a>, which details how MongoDB schemas should be organized in three separate blog posts. So please take a look if this summarization is not sufficient.</p>
<p>If you are new to MongoDB it is natural to ask how should one structure the schema for One-to-Many relationship.</p>
<h2 id="basics"><a href="#basics" class="anchor"></a>Basics</h2>
<p>Relationships can be in three different forms:</p>
<ul>
<li>One-to-Few</li>
<li>One-to-Many</li>
<li>One-to-Squillions</li>
</ul>
<p>Each method for structuring has its pros and cons. So the user should know how to decide which one is better than the other in the given situation.</p>
<h2 id="one-to-few"><a href="#one-to-few" class="anchor"></a>One-to-Few</h2>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#24292e;color:#e1e4e8" tabindex="0" data-language="javascript" data-theme="github-dark"><code data-language="javascript" data-theme="github-dark" style="display:grid"><span data-line=""><span style="color:#6A737D">// person</span></span>
<span data-line=""><span style="color:#E1E4E8">{</span></span>
<span data-line=""><span style="color:#B392F0">  name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;Keon Kim&quot;</span><span style="color:#E1E4E8">,</span></span>
<span data-line=""><span style="color:#B392F0">  hometown</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;Seoul&quot;</span><span style="color:#E1E4E8">,</span></span>
<span data-line=""><span style="color:#B392F0">  addresses</span><span style="color:#E1E4E8">: [</span></span>
<span data-line=""><span style="color:#E1E4E8">    { city: </span><span style="color:#9ECBFF">&#x27;Manhattan&#x27;</span><span style="color:#E1E4E8">, state: </span><span style="color:#9ECBFF">&#x27;NY&#x27;</span><span style="color:#E1E4E8">, cc: </span><span style="color:#9ECBFF">&#x27;USA&#x27;</span><span style="color:#E1E4E8"> },</span></span>
<span data-line=""><span style="color:#E1E4E8">    { city: </span><span style="color:#9ECBFF">&#x27;Jersey City&#x27;</span><span style="color:#E1E4E8">, state: </span><span style="color:#9ECBFF">&#x27;NJ&#x27;</span><span style="color:#E1E4E8">, cc: </span><span style="color:#9ECBFF">&#x27;USA&#x27;</span><span style="color:#E1E4E8"> }</span></span>
<span data-line=""><span style="color:#E1E4E8">  ]</span></span>
<span data-line=""><span style="color:#E1E4E8">}</span></span></code></pre></figure>
<p><strong>Pros</strong></p>
<ul>
<li>You can call all the information in one query</li>
</ul>
<p><strong>Cons</strong></p>
<ul>
<li>It is impossible to search the contained entity independently.</li>
</ul>
<h2 id="one-to-many"><a href="#one-to-many" class="anchor"></a>One-to-Many</h2>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#24292e;color:#e1e4e8" tabindex="0" data-language="javascript" data-theme="github-dark"><code data-language="javascript" data-theme="github-dark" style="display:grid"><span data-line=""><span style="color:#6A737D">// parts</span></span>
<span data-line=""><span style="color:#E1E4E8">{</span></span>
<span data-line=""><span style="color:#B392F0">  _id</span><span style="color:#E1E4E8">: </span><span style="color:#B392F0">ObjectID</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&#x27;AAAA&#x27;</span><span style="color:#E1E4E8">),</span></span>
<span data-line=""><span style="color:#B392F0">  partno</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&#x27;123-aff-456&#x27;</span><span style="color:#E1E4E8">,</span></span>
<span data-line=""><span style="color:#B392F0">  name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&#x27;Awesometel 100Ghz CPU&#x27;</span><span style="color:#E1E4E8">,</span></span>
<span data-line=""><span style="color:#B392F0">  qty</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">102</span><span style="color:#E1E4E8">,</span></span>
<span data-line=""><span style="color:#B392F0">  cost</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">1.21</span><span style="color:#E1E4E8">,</span></span>
<span data-line=""><span style="color:#B392F0">  price</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">3.99</span></span>
<span data-line=""><span style="color:#E1E4E8">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#6A737D">// products</span></span>
<span data-line=""><span style="color:#E1E4E8">{</span></span>
<span data-line=""><span style="color:#B392F0">  name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&#x27;Weird Computer WC-3020&#x27;</span><span style="color:#E1E4E8">,</span></span>
<span data-line=""><span style="color:#B392F0">  manufacturer</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&#x27;Haruair Eng.&#x27;</span><span style="color:#E1E4E8">,</span></span>
<span data-line=""><span style="color:#B392F0">  catalog_number</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">1234</span><span style="color:#E1E4E8">,</span></span>
<span data-line=""><span style="color:#B392F0">  parts</span><span style="color:#E1E4E8">: [</span></span>
<span data-line=""><span style="color:#B392F0">    ObjectID</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&#x27;AAAA&#x27;</span><span style="color:#E1E4E8">),</span></span>
<span data-line=""><span style="color:#B392F0">    ObjectID</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&#x27;DEFO&#x27;</span><span style="color:#E1E4E8">),</span></span>
<span data-line=""><span style="color:#B392F0">    ObjectID</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&#x27;EJFW&#x27;</span><span style="color:#E1E4E8">)</span></span>
<span data-line=""><span style="color:#E1E4E8">  ]</span></span>
<span data-line=""><span style="color:#E1E4E8">}</span></span></code></pre></figure>
<p>Parent holds the list of ObjectID of the child documents. This requires an application level join, not the database level join.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#24292e;color:#e1e4e8" tabindex="0" data-language="javascript" data-theme="github-dark"><code data-language="javascript" data-theme="github-dark" style="display:grid"><span data-line=""><span style="color:#6A737D">// find product based on category_number.</span></span>
<span data-line=""><span style="color:#F97583">&gt;</span><span style="color:#E1E4E8"> product </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> db.products.</span><span style="color:#B392F0">findOne</span><span style="color:#E1E4E8">({catalog_number: </span><span style="color:#79B8FF">1234</span><span style="color:#E1E4E8">});</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#6A737D">// find all parts in the product&#x27;s parts list.</span></span>
<span data-line=""><span style="color:#F97583">&gt;</span><span style="color:#E1E4E8"> product_parts </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> db.parts.</span><span style="color:#B392F0">find</span><span style="color:#E1E4E8">({</span></span>
<span data-line=""><span style="color:#E1E4E8">                      _id: { $in : product.parts }</span></span>
<span data-line=""><span style="color:#E1E4E8">                   }).</span><span style="color:#B392F0">toArray</span><span style="color:#E1E4E8">();</span></span></code></pre></figure>
<p><strong>Pros</strong></p>
<ul>
<li>It is easy to handle insert, delete on each documents independently.</li>
<li>It has flexibility for implementing N-to-N relationship because it is an application level join.</li>
</ul>
<p><strong>Cons</strong></p>
<ul>
<li>Performance drops as you call documents multiple times.</li>
</ul>
<h2 id="one-to-squillions"><a href="#one-to-squillions" class="anchor"></a>One-to-Squillions</h2>
<p>If you need to store tons of data (ie. event logs), you need to use a different approach since a document cannot be larger than 16MB in size. You need to use &#x27;parent-referencing&#x27;.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#24292e;color:#e1e4e8" tabindex="0" data-language="javascript" data-theme="github-dark"><code data-language="javascript" data-theme="github-dark" style="display:grid"><span data-line=""><span style="color:#6A737D">// host</span></span>
<span data-line=""><span style="color:#E1E4E8">{</span></span>
<span data-line=""><span style="color:#B392F0">  _id</span><span style="color:#E1E4E8"> : </span><span style="color:#B392F0">ObjectID</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&#x27;AAAB&#x27;</span><span style="color:#E1E4E8">),</span></span>
<span data-line=""><span style="color:#B392F0">  name</span><span style="color:#E1E4E8"> : </span><span style="color:#9ECBFF">&#x27;goofy.example.com&#x27;</span><span style="color:#E1E4E8">,</span></span>
<span data-line=""><span style="color:#B392F0">  ipaddr</span><span style="color:#E1E4E8"> : </span><span style="color:#9ECBFF">&#x27;127.66.66.66&#x27;</span></span>
<span data-line=""><span style="color:#E1E4E8">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#6A737D">// logmsg</span></span>
<span data-line=""><span style="color:#E1E4E8">{</span></span>
<span data-line=""><span style="color:#B392F0">  time</span><span style="color:#E1E4E8"> : </span><span style="color:#B392F0">ISODate</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;2015-09-02T09:10:09.032Z&quot;</span><span style="color:#E1E4E8">),</span></span>
<span data-line=""><span style="color:#B392F0">  message</span><span style="color:#E1E4E8"> : </span><span style="color:#9ECBFF">&#x27;cpu is on fire!&#x27;</span><span style="color:#E1E4E8">,</span></span>
<span data-line=""><span style="color:#B392F0">  host</span><span style="color:#E1E4E8">: </span><span style="color:#B392F0">ObjectID</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&#x27;AAAB&#x27;</span><span style="color:#E1E4E8">)       </span><span style="color:#6A737D">// references Host document</span></span>
<span data-line=""><span style="color:#E1E4E8">}</span></span></code></pre></figure>
<p>Later you can join like below:</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#24292e;color:#e1e4e8" tabindex="0" data-language="javascript" data-theme="github-dark"><code data-language="javascript" data-theme="github-dark" style="display:grid"><span data-line=""><span style="color:#6A737D">// Search parent host document</span></span>
<span data-line=""><span style="color:#F97583">&gt;</span><span style="color:#E1E4E8"> host </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> db.hosts.</span><span style="color:#B392F0">findOne</span><span style="color:#E1E4E8">({ipaddr : </span><span style="color:#9ECBFF">&#x27;127.66.66.66&#x27;</span><span style="color:#E1E4E8">});</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#6A737D">// Search the most recent 5000 logs</span></span>
<span data-line=""><span style="color:#6A737D">// for a host based on host&#x27;s ObjectID</span></span>
<span data-line=""><span style="color:#F97583">&gt;</span><span style="color:#E1E4E8"> last_5k_msg </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> db.logmsg.</span><span style="color:#B392F0">find</span><span style="color:#E1E4E8">({host: host._id})</span></span>
<span data-line=""><span style="color:#E1E4E8">                         .</span><span style="color:#B392F0">sort</span><span style="color:#E1E4E8">({time : </span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">})</span></span>
<span data-line=""><span style="color:#E1E4E8">                         .</span><span style="color:#B392F0">limit</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">5000</span><span style="color:#E1E4E8">)</span></span>
<span data-line=""><span style="color:#E1E4E8">                         .</span><span style="color:#B392F0">toArray</span><span style="color:#E1E4E8">()</span></span></code></pre></figure>
<h2 id="denormalization"><a href="#denormalization" class="anchor"></a>Denormalization</h2>
<p>In order to speed up the query, you can denormalize the data.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#24292e;color:#e1e4e8" tabindex="0" data-language="javascript" data-theme="github-dark"><code data-language="javascript" data-theme="github-dark" style="display:grid"><span data-line=""><span style="color:#6A737D">// logmsg - before</span></span>
<span data-line=""><span style="color:#E1E4E8">{</span></span>
<span data-line=""><span style="color:#B392F0">  time</span><span style="color:#E1E4E8"> : </span><span style="color:#B392F0">ISODate</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;2015-09-02T09:10:09.032Z&quot;</span><span style="color:#E1E4E8">),</span></span>
<span data-line=""><span style="color:#B392F0">  message</span><span style="color:#E1E4E8"> : </span><span style="color:#9ECBFF">&#x27;cpu is on fire!&#x27;</span><span style="color:#E1E4E8">,</span></span>
<span data-line=""><span style="color:#B392F0">  host</span><span style="color:#E1E4E8">: </span><span style="color:#B392F0">ObjectID</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&#x27;AAAB&#x27;</span><span style="color:#E1E4E8">)</span></span>
<span data-line=""><span style="color:#E1E4E8">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#6A737D">// logmsg - after</span></span>
<span data-line=""><span style="color:#E1E4E8">{</span></span>
<span data-line=""><span style="color:#B392F0">  time</span><span style="color:#E1E4E8"> : </span><span style="color:#B392F0">ISODate</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;2015-09-02T09:10:09.032Z&quot;</span><span style="color:#E1E4E8">),</span></span>
<span data-line=""><span style="color:#B392F0">  message</span><span style="color:#E1E4E8"> : </span><span style="color:#9ECBFF">&#x27;cpu is on fire!&#x27;</span><span style="color:#E1E4E8">,</span></span>
<span data-line=""><span style="color:#B392F0">  host</span><span style="color:#E1E4E8">: </span><span style="color:#B392F0">ObjectID</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&#x27;AAAB&#x27;</span><span style="color:#E1E4E8">),</span></span>
<span data-line=""><span style="color:#B392F0">  ipaddr</span><span style="color:#E1E4E8"> : </span><span style="color:#9ECBFF">&#x27;127.66.66.66&#x27;</span></span>
<span data-line=""><span style="color:#E1E4E8">}</span></span></code></pre></figure>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#24292e;color:#e1e4e8" tabindex="0" data-language="javascript" data-theme="github-dark"><code data-language="javascript" data-theme="github-dark" style="display:grid"><span data-line=""><span style="color:#F97583">&gt;</span><span style="color:#E1E4E8"> last_5k_msg </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> db.logmsg.</span><span style="color:#B392F0">find</span><span style="color:#E1E4E8">({ipaddr : </span><span style="color:#9ECBFF">&#x27;127.66.66.66&#x27;</span><span style="color:#E1E4E8">})</span></span>
<span data-line=""><span style="color:#E1E4E8">                         .</span><span style="color:#B392F0">sort</span><span style="color:#E1E4E8">({time : </span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">})</span></span>
<span data-line=""><span style="color:#E1E4E8">                         .</span><span style="color:#B392F0">limit</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">5000</span><span style="color:#E1E4E8">)</span></span>
<span data-line=""><span style="color:#E1E4E8">                         .</span><span style="color:#B392F0">toArray</span><span style="color:#E1E4E8">()</span></span></code></pre></figure>
<p>In fact, you can merge the two documents:</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#24292e;color:#e1e4e8" tabindex="0" data-language="javascript" data-theme="github-dark"><code data-language="javascript" data-theme="github-dark" style="display:grid"><span data-line=""><span style="color:#E1E4E8">{</span></span>
<span data-line=""><span style="color:#B392F0">    time</span><span style="color:#E1E4E8"> : </span><span style="color:#B392F0">ISODate</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;2015-09-02T09:10:09.032Z&quot;</span><span style="color:#E1E4E8">),</span></span>
<span data-line=""><span style="color:#B392F0">    message</span><span style="color:#E1E4E8"> : </span><span style="color:#9ECBFF">&#x27;cpu is on fire!&#x27;</span><span style="color:#E1E4E8">,</span></span>
<span data-line=""><span style="color:#B392F0">    ipaddr</span><span style="color:#E1E4E8"> : </span><span style="color:#9ECBFF">&#x27;127.66.66.66&#x27;</span><span style="color:#E1E4E8">,</span></span>
<span data-line=""><span style="color:#B392F0">    hostname</span><span style="color:#E1E4E8"> : </span><span style="color:#9ECBFF">&#x27;goofy.example.com&#x27;</span></span>
<span data-line=""><span style="color:#E1E4E8">}</span></span></code></pre></figure>
<p>It would be used like this in the code:</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#24292e;color:#e1e4e8" tabindex="0" data-language="javascript" data-theme="github-dark"><code data-language="javascript" data-theme="github-dark" style="display:grid"><span data-line=""><span style="color:#6A737D">// receive log from monitoring program.</span></span>
<span data-line=""><span style="color:#E1E4E8">logmsg </span><span style="color:#F97583">=</span><span style="color:#B392F0"> get_log_msg</span><span style="color:#E1E4E8">();</span></span>
<span data-line=""><span style="color:#E1E4E8">log_message_here </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> logmsg.msg;</span></span>
<span data-line=""><span style="color:#E1E4E8">log_ip </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> logmsg.ipaddr;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#6A737D">// get timestamp</span></span>
<span data-line=""><span style="color:#E1E4E8">now </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Date</span><span style="color:#E1E4E8">();</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#6A737D">// find host&#x27;s id for update</span></span>
<span data-line=""><span style="color:#E1E4E8">host_doc </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> db.hosts.</span><span style="color:#B392F0">findOne</span><span style="color:#E1E4E8">({ ipaddr: log_ip },{ _id: </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8"> });</span></span>
<span data-line=""><span style="color:#E1E4E8">host_id </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> host_doc._id;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#6A737D">// save denoramlized data</span></span>
<span data-line=""><span style="color:#E1E4E8">db.logmsg.</span><span style="color:#B392F0">save</span><span style="color:#E1E4E8">({</span></span>
<span data-line=""><span style="color:#E1E4E8">    time : now,</span></span>
<span data-line=""><span style="color:#E1E4E8">    message : log_message_here,</span></span>
<span data-line=""><span style="color:#E1E4E8">    ipaddr : log_ip,</span></span>
<span data-line=""><span style="color:#E1E4E8">    host : host_id ) });</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#6A737D">// Push the denoramlized data in &#x27;one&#x27;</span></span>
<span data-line=""><span style="color:#E1E4E8">db.hosts.</span><span style="color:#B392F0">update</span><span style="color:#E1E4E8">( {_id: host_id }, {</span></span>
<span data-line=""><span style="color:#E1E4E8">    $push : {</span></span>
<span data-line=""><span style="color:#E1E4E8">      logmsgs : {</span></span>
<span data-line=""><span style="color:#E1E4E8">        $each:  [ { time : now, message : log_message_here } ],</span></span>
<span data-line=""><span style="color:#E1E4E8">        $sort:  { time : </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8"> },  </span><span style="color:#6A737D">// sort by time</span></span>
<span data-line=""><span style="color:#E1E4E8">        $slice: </span><span style="color:#F97583">-</span><span style="color:#79B8FF">1000</span><span style="color:#6A737D">          // get top 1000</span></span>
<span data-line=""><span style="color:#E1E4E8">      }</span></span>
<span data-line=""><span style="color:#E1E4E8">    }</span></span>
<span data-line=""><span style="color:#E1E4E8">  });</span></span></code></pre></figure>
<h2 id="6-rules-of-thumb"><a href="#6-rules-of-thumb" class="anchor"></a>6 Rules of Thumb</h2>
<p>Here are some &quot;rules of thumb&quot; to guide you through these innumerable (but not infinite) choices:</p>
<ol>
<li>Favor embedding unless there is a compelling reason not to</li>
<li>Needing to access an object on its own is a compelling reason not to embed it</li>
<li>Arrays should not grow without bound. If there are more than a couple of hundred documents on the &quot;many&quot; side, don&#x27;t embed them; if there are more than a few thousand documents on the &quot;many&quot; side, don&#x27;t use an array of ObjectID references. High-cardinality arrays are a compelling reason not to embed.</li>
<li>Don&#x27;t be afraid of application-level joins: if you index correctly and use the projection specifier then application-level joins are barely more expensive than server-side joins in a relational database.</li>
<li>Consider the write/read ratio when denormalizing. A field that will mostly be read and only seldom updated is a good candidate for denormalization: if you denormalize a field that is updated frequently then the extra work of finding and updating all the instances is likely to overwhelm the savings that you get from denormalizing.</li>
<li>As always with MongoDB, how you model your data depends – entirely – on your particular application&#x27;s data access patterns. You want to structure your data to match the ways that your application queries and updates it.</li>
</ol>
<h2 id="references"><a href="#references" class="anchor"></a>References</h2>
<ul>
<li><a target="_blank" rel="noopener noreferrer" href="https://www.mongodb.com/blog/post/6-rules-of-thumb-for-mongodb-schema-design-part-1">6 Rules of Thumb for MongoDB Schema Design Part 1</a></li>
<li><a target="_blank" rel="noopener noreferrer" href="https://www.mongodb.com/blog/post/6-rules-of-thumb-for-mongodb-schema-design-part-2">6 Rules of Thumb for MongoDB Schema Design Part 2</a></li>
<li><a target="_blank" rel="noopener noreferrer" href="https://www.mongodb.com/blog/post/6-rules-of-thumb-for-mongodb-schema-design-part-3">6 Rules of Thumb for MongoDB Schema Design Part 3</a></li>
</ul></article></section><!--$--><!--/$--><footer class="mb-4 mt-12"><div class="flex justify-between text-xs opacity-50"><div class="flex"><span class="relative group mr-3 last:mr-0"><a class="hover:opacity-100 transition-opacity" rel="noopener noreferrer" target="_blank" href="/rss" data-umami-event="click-rss">rss</a><span class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 text-[10px] border border-neutral-300 dark:border-neutral-600 bg-white dark:bg-black text-black dark:text-white opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none">Subscribe to RSS feed</span></span><span class="relative group mr-3 last:mr-0"><a class="hover:opacity-100 transition-opacity" rel="noopener noreferrer" target="_blank" href="https://github.com/keon" data-umami-event="click-github">github</a><span class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 text-[10px] border border-neutral-300 dark:border-neutral-600 bg-white dark:bg-black text-black dark:text-white opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none">View GitHub profile</span></span><span class="relative group mr-3 last:mr-0"><a class="hover:opacity-100 transition-opacity" rel="noopener noreferrer" target="_blank" href="https://www.linkedin.com/in/keon/" data-umami-event="click-linkedin">linkedin</a><span class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 text-[10px] border border-neutral-300 dark:border-neutral-600 bg-white dark:bg-black text-black dark:text-white opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none">Connect on LinkedIn</span></span><span class="relative group mr-3 last:mr-0"><a class="hover:opacity-100 transition-opacity" rel="noopener noreferrer" target="_blank" href="https://x.com/keonwkim" data-umami-event="click-x">x</a><span class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 text-[10px] border border-neutral-300 dark:border-neutral-600 bg-white dark:bg-black text-black dark:text-white opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none">Follow on X</span></span></div></div></footer><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><!--/$--></main><script src="/_next/static/chunks/1e4a5921a7142076.js" id="_R_" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[66401,[\"/_next/static/chunks/7a1cc90d8d7c91eb.js\"],\"\"]\n3:I[78580,[\"/_next/static/chunks/7a1cc90d8d7c91eb.js\"],\"ThemeProvider\"]\n4:I[35762,[\"/_next/static/chunks/7a1cc90d8d7c91eb.js\",\"/_next/static/chunks/1ca67093247280ae.js\"],\"\"]\n5:I[79202,[\"/_next/static/chunks/7a1cc90d8d7c91eb.js\"],\"ThemeToggle\"]\n6:I[22871,[\"/_next/static/chunks/fec5ea6183d0e55b.js\",\"/_next/static/chunks/3b60e5197848a126.js\"],\"default\"]\n7:I[59801,[\"/_next/static/chunks/fec5ea6183d0e55b.js\",\"/_next/static/chunks/3b60e5197848a126.js\"],\"default\"]\n8:I[28192,[\"/_next/static/chunks/7a1cc90d8d7c91eb.js\"],\"default\"]\n9:I[84399,[\"/_next/static/chunks/7a1cc90d8d7c91eb.js\"],\"Analytics\"]\na:I[60685,[\"/_next/static/chunks/7a1cc90d8d7c91eb.js\"],\"SpeedInsights\"]\nc:I[98427,[\"/_next/static/chunks/fec5ea6183d0e55b.js\",\"/_next/static/chunks/3b60e5197848a126.js\"],\"OutletBoundary\"]\nd:\"$Sreact.suspense\"\nf:I[98427,[\"/_next/static/chunks/fec5ea6183d0e55b.js\",\"/_next/static/chunks/3b60e5197848a126.js\"],\"ViewportBoundary\"]\n11:I[98427,[\"/_next/static/chunks/fec5ea6183d0e55b.js\",\"/_next/static/chunks/3b60e5197848a126.js\"],\"MetadataBoundary\"]\n13:I[32257,[\"/_next/static/chunks/fec5ea6183d0e55b.js\",\"/_next/static/chunks/3b60e5197848a126.js\"],\"default\"]\n:HL[\"/_next/static/chunks/59edfdd82909e7e2.css\",\"style\"]\n:HL[\"/_next/static/media/GeistMono_Variable.p.73882635.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"S9VwBvixHK3qfKMKpMISo\",\"c\":[\"\",\"writing\",\"mongodb-schema-design\",\"\"],\"q\":\"\",\"i\":false,\"f\":[[[\"\",{\"children\":[[\"contentType\",\"writing\",\"d\"],{\"children\":[[\"slug\",\"mongodb-schema-design\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/chunks/59edfdd82909e7e2.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-0\",{\"src\":\"/_next/static/chunks/7a1cc90d8d7c91eb.js\",\"async\":true,\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"className\":\"geistmono_157ca88a-module__TXdLRq__variable\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"head\",null,{\"children\":[\"$\",\"$L2\",null,{\"defer\":true,\"src\":\"https://cloud.umami.is/script.js\",\"data-website-id\":\"2c2856a8-9039-4dc9-afcb-dd2b99f3f4fe\",\"strategy\":\"afterInteractive\"}]}],[\"$\",\"body\",null,{\"className\":\"font-mono antialiased max-w-2xl mx-4 mt-6 lg:mx-auto text-sm text-black bg-white dark:text-white dark:bg-black\",\"children\":[\"$\",\"$L3\",null,{\"attribute\":\"class\",\"defaultTheme\":\"system\",\"enableSystem\":true,\"disableTransitionOnChange\":true,\"children\":[\"$\",\"main\",null,{\"className\":\"flex-auto min-w-0 mt-4 flex flex-col px-2 md:px-0\",\"children\":[[\"$\",\"aside\",null,{\"className\":\"-ml-[8px] mb-8 tracking-tight\",\"children\":[\"$\",\"div\",null,{\"className\":\"lg:sticky lg:top-20\",\"children\":[\"$\",\"nav\",null,{\"className\":\"flex flex-row items-center justify-between relative px-0 pb-0 fade md:overflow-auto scroll-pr-6 md:relative\",\"id\":\"nav\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex flex-row space-x-0 pr-10\",\"children\":[[\"$\",\"$L4\",\"/\",{\"href\":\"/\",\"className\":\"transition-all hover:bg-black hover:text-white dark:hover:bg-white dark:hover:text-black flex align-middle relative py-1 px-2 m-1\",\"children\":\"home\"}],[\"$\",\"$L4\",\"/writing\",{\"href\":\"/writing\",\"className\":\"transition-all hover:bg-black hover:text-white dark:hover:bg-white dark:hover:text-black flex align-middle relative py-1 px-2 m-1\",\"children\":\"writing\"}]]}],[\"$\",\"$L5\",null,{}]]}]}]}],[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"section\",null,{\"children\":[[\"$\",\"h1\",null,{\"className\":\"mb-8 text-2xl font-semibold tracking-tighter\",\"children\":\"404 - Page Not Found\"}],[\"$\",\"p\",null,{\"className\":\"mb-4\",\"children\":\"The page you are looking for does not exist.\"}]]}],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}],[\"$\",\"$L8\",null,{}],[\"$\",\"$L9\",null,{}],[\"$\",\"$La\",null,{}]]}]}]}]]}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[\"$Lb\",[[\"$\",\"script\",\"script-0\",{\"src\":\"/_next/static/chunks/1ca67093247280ae.js\",\"async\":true,\"nonce\":\"$undefined\"}]],[\"$\",\"$Lc\",null,{\"children\":[\"$\",\"$d\",null,{\"name\":\"Next.MetadataOutlet\",\"children\":\"$@e\"}]}]]}],{},null,false,false]},null,false,false]},null,false,false]},null,false,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$Lf\",null,{\"children\":\"$L10\"}],[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$L11\",null,{\"children\":[\"$\",\"$d\",null,{\"name\":\"Next.Metadata\",\"children\":\"$L12\"}]}]}],null]}],false]],\"m\":\"$undefined\",\"G\":[\"$13\",[]],\"S\":true}\n"])</script><script>self.__next_f.push([1,"14:I[28388,[\"/_next/static/chunks/7a1cc90d8d7c91eb.js\",\"/_next/static/chunks/1ca67093247280ae.js\"],\"RelativeTime\"]\nb:[\"$\",\"section\",null,{\"children\":[[\"$\",\"h1\",null,{\"className\":\"title font-bold text-lg\",\"children\":\"Rules of Thumb for MongoDB Schema Design\"}],[\"$\",\"div\",null,{\"className\":\"flex justify-between items-center mt-1 mb-6 text-xs\",\"children\":[\"$\",\"$L14\",null,{\"date\":\"2017-01-11\"}]}],[\"$\",\"article\",null,{\"className\":\"prose\",\"children\":\"$L15\"}]]}]\n"])</script><script>self.__next_f.push([1,"10:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"16:I[61212,[\"/_next/static/chunks/fec5ea6183d0e55b.js\",\"/_next/static/chunks/3b60e5197848a126.js\"],\"IconMark\"]\ne:null\n"])</script><script>self.__next_f.push([1,"12:[[\"$\",\"title\",\"0\",{\"children\":\"Keon Kim\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"Keon's blog.\"}],[\"$\",\"link\",\"2\",{\"rel\":\"manifest\",\"href\":\"/favicon/site.webmanifest\",\"crossOrigin\":\"$undefined\"}],[\"$\",\"meta\",\"3\",{\"name\":\"robots\",\"content\":\"index, follow\"}],[\"$\",\"meta\",\"4\",{\"name\":\"googlebot\",\"content\":\"index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1\"}],[\"$\",\"meta\",\"5\",{\"property\":\"og:title\",\"content\":\"Keon Kim\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:description\",\"content\":\"Keon's blog.\"}],[\"$\",\"meta\",\"7\",{\"property\":\"og:url\",\"content\":\"https://keon.github.io/\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:site_name\",\"content\":\"Keon Kim\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:locale\",\"content\":\"en_US\"}],[\"$\",\"meta\",\"10\",{\"property\":\"og:type\",\"content\":\"website\"}],[\"$\",\"meta\",\"11\",{\"name\":\"twitter:card\",\"content\":\"summary\"}],[\"$\",\"meta\",\"12\",{\"name\":\"twitter:title\",\"content\":\"Keon Kim\"}],[\"$\",\"meta\",\"13\",{\"name\":\"twitter:description\",\"content\":\"Keon's blog.\"}],[\"$\",\"link\",\"14\",{\"rel\":\"icon\",\"href\":\"/favicon/favicon-16x16.png\",\"sizes\":\"16x16\",\"type\":\"image/png\"}],[\"$\",\"link\",\"15\",{\"rel\":\"icon\",\"href\":\"/favicon/favicon-32x32.png\",\"sizes\":\"32x32\",\"type\":\"image/png\"}],[\"$\",\"link\",\"16\",{\"rel\":\"icon\",\"href\":\"/favicon/favicon.ico\",\"sizes\":\"any\"}],[\"$\",\"link\",\"17\",{\"rel\":\"apple-touch-icon\",\"href\":\"/favicon/apple-touch-icon.png\",\"sizes\":\"180x180\",\"type\":\"image/png\"}],[\"$\",\"link\",\"18\",{\"rel\":\"android-chrome-192x192\",\"href\":\"/favicon/android-chrome-192x192.png\"}],[\"$\",\"link\",\"19\",{\"rel\":\"android-chrome-512x512\",\"href\":\"/favicon/android-chrome-512x512.png\"}],[\"$\",\"$L16\",\"20\",{}]]\n"])</script><script>self.__next_f.push([1,"15:[[\"$\",\"p\",null,{\"children\":[\"This is a summary of \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://www.mongodb.com/blog/post/6-rules-of-thumb-for-mongodb-schema-design-part-1\",\"children\":\"6 Rules of Thumb for MongoDB Schema Design\"}],\", which details how MongoDB schemas should be organized in three separate blog posts. So please take a look if this summarization is not sufficient.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"If you are new to MongoDB it is natural to ask how should one structure the schema for One-to-Many relationship.\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"basics\",\"children\":[[[\"$\",\"a\",\"link-basics\",{\"href\":\"#basics\",\"className\":\"anchor\"}]],\"Basics\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Relationships can be in three different forms:\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"One-to-Few\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"One-to-Many\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"One-to-Squillions\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Each method for structuring has its pros and cons. So the user should know how to decide which one is better than the other in the given situation.\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"one-to-few\",\"children\":[[[\"$\",\"a\",\"link-one-to-few\",{\"href\":\"#one-to-few\",\"className\":\"anchor\"}]],\"One-to-Few\"]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#24292e\",\"color\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"// person\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"{\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"  name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"\\\"Keon Kim\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"  hometown\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"\\\"Seoul\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"  addresses\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": [\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"    { city: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"'Manhattan'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\", state: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"'NY'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\", cc: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"'USA'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\" },\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"    { city: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"'Jersey City'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\", state: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"'NJ'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\", cc: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"'USA'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\" }\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"  ]\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Pros\"}]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"You can call all the information in one query\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Cons\"}]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"It is impossible to search the contained entity independently.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"one-to-many\",\"children\":[[[\"$\",\"a\",\"link-one-to-many\",{\"href\":\"#one-to-many\",\"className\":\"anchor\"}]],\"One-to-Many\"]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#24292e\",\"color\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",\"style\":{\"display\":\"grid\"},\"children\":[\"$L17\",\"\\n\",\"$L18\",\"\\n\",\"$L19\",\"\\n\",\"$L1a\",\"\\n\",\"$L1b\",\"\\n\",\"$L1c\",\"\\n\",\"$L1d\",\"\\n\",\"$L1e\",\"\\n\",\"$L1f\",\"\\n\",\"$L20\",\"\\n\",\"$L21\",\"\\n\",\"$L22\",\"\\n\",\"$L23\",\"\\n\",\"$L24\",\"\\n\",\"$L25\",\"\\n\",\"$L26\",\"\\n\",\"$L27\",\"\\n\",\"$L28\",\"\\n\",\"$L29\",\"\\n\",\"$L2a\",\"\\n\",\"$L2b\"]}]}]}],\"\\n\",\"$L2c\",\"\\n\",\"$L2d\",\"\\n\",\"$L2e\",\"\\n\",\"$L2f\",\"\\n\",\"$L30\",\"\\n\",\"$L31\",\"\\n\",\"$L32\",\"\\n\",\"$L33\",\"\\n\",\"$L34\",\"\\n\",\"$L35\",\"\\n\",\"$L36\",\"\\n\",\"$L37\",\"\\n\",\"$L38\",\"\\n\",\"$L39\",\"\\n\",\"$L3a\",\"\\n\",\"$L3b\",\"\\n\",\"$L3c\",\"\\n\",\"$L3d\",\"\\n\",\"$L3e\",\"\\n\",\"$L3f\",\"\\n\",\"$L40\",\"\\n\",\"$L41\",\"\\n\",\"$L42\",\"\\n\",\"$L43\"]\n"])</script><script>self.__next_f.push([1,"17:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"// parts\"}]}]\n18:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"{\"}]}]\n19:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"  _id\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"ObjectID\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"'AAAA'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"),\"}]]}]\n1a:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"  partno\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"'123-aff-456'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\",\"}]]}]\n1b:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"  name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"'Awesometel 100Ghz CPU'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\",\"}]]}]\n1c:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"  qty\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\"102\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\",\"}]]}]\n1d:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"  cost\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\"1.21\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\",\"}]]}]\n1e:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"  price\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\"3.99\"}]]}]\n1f:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"}\"}]}]\n20:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}]\n21:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"// products\"}]}]\n22:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"{\"}]}]\n23:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"  name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"'Weird Computer WC-3020'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\",\"}]]}]\n24:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"  manufacturer\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"'Haruair Eng.'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\",\"}]]}]\n25:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"  catalog_number\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\"1234\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\",\"}]]}]\n26:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"  parts\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": [\"}]]}]\n27:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"    ObjectID\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"'AAAA'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"),\"}]]}]\n28:["])</script><script>self.__next_f.push([1,"\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"    ObjectID\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"'DEFO'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"),\"}]]}]\n29:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"    ObjectID\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"'EJFW'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\")\"}]]}]\n2a:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"  ]\"}]}]\n2b:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"}\"}]}]\n2c:[\"$\",\"p\",null,{\"children\":\"Parent holds the list of ObjectID of the child documents. This requires an application level join, not the database level join.\"}]\n"])</script><script>self.__next_f.push([1,"2d:[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#24292e\",\"color\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"// find product based on category_number.\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\" product \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\" db.products.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"findOne\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"({catalog_number: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\"1234\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"});\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"// find all parts in the product's parts list.\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\" product_parts \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\" db.parts.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"find\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"({\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"                      _id: { $in : product.parts }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"                   }).\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"toArray\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"();\"}]]}]]}]}]}]\n"])</script><script>self.__next_f.push([1,"2e:[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Pros\"}]}]\n2f:[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"It is easy to handle insert, delete on each documents independently.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"It has flexibility for implementing N-to-N relationship because it is an application level join.\"}],\"\\n\"]}]\n30:[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Cons\"}]}]\n31:[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Performance drops as you call documents multiple times.\"}],\"\\n\"]}]\n32:[\"$\",\"h2\",null,{\"id\":\"one-to-squillions\",\"children\":[[[\"$\",\"a\",\"link-one-to-squillions\",{\"href\":\"#one-to-squillions\",\"className\":\"anchor\"}]],\"One-to-Squillions\"]}]\n33:[\"$\",\"p\",null,{\"children\":\"If you need to store tons of data (ie. event logs), you need to use a different approach since a document cannot be larger than 16MB in size. You need to use 'parent-referencing'.\"}]\n"])</script><script>self.__next_f.push([1,"34:[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#24292e\",\"color\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"// host\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"{\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"  _id\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\" : \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"ObjectID\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"'AAAB'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"),\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"  name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\" : \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"'goofy.example.com'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"  ipaddr\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\" : \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"'127.66.66.66'\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"// logmsg\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"{\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"  time\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\" : \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"ISODate\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"\\\"2015-09-02T09:10:09.032Z\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"),\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"  message\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\" : \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"'cpu is on fire!'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"  host\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"ObjectID\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"'AAAB'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\")       \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"// references Host document\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"}\"}]}]]}]}]}]\n"])</script><script>self.__next_f.push([1,"35:[\"$\",\"p\",null,{\"children\":\"Later you can join like below:\"}]\n"])</script><script>self.__next_f.push([1,"36:[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#24292e\",\"color\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"// Search parent host document\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\" host \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\" db.hosts.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"findOne\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"({ipaddr : \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"'127.66.66.66'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"});\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"// Search the most recent 5000 logs\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"// for a host based on host's ObjectID\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\" last_5k_msg \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\" db.logmsg.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"find\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"({host: host._id})\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"                         .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"sort\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"({time : \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\"-\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\"1\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"})\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"                         .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"limit\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\"5000\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\")\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"                         .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"toArray\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"()\"}]]}]]}]}]}]\n"])</script><script>self.__next_f.push([1,"37:[\"$\",\"h2\",null,{\"id\":\"denormalization\",\"children\":[[[\"$\",\"a\",\"link-denormalization\",{\"href\":\"#denormalization\",\"className\":\"anchor\"}]],\"Denormalization\"]}]\n38:[\"$\",\"p\",null,{\"children\":\"In order to speed up the query, you can denormalize the data.\"}]\n"])</script><script>self.__next_f.push([1,"39:[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#24292e\",\"color\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"// logmsg - before\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"{\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"  time\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\" : \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"ISODate\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"\\\"2015-09-02T09:10:09.032Z\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"),\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"  message\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\" : \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"'cpu is on fire!'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"  host\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"ObjectID\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"'AAAB'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\")\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"// logmsg - after\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"{\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"  time\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\" : \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"ISODate\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"\\\"2015-09-02T09:10:09.032Z\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"),\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"  message\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\" : \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"'cpu is on fire!'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"  host\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"ObjectID\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"'AAAB'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"),\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"  ipaddr\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\" : \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"'127.66.66.66'\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"}\"}]}]]}]}]}]\n"])</script><script>self.__next_f.push([1,"3a:[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#24292e\",\"color\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\" last_5k_msg \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\" db.logmsg.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"find\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"({ipaddr : \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"'127.66.66.66'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"})\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"                         .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"sort\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"({time : \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\"-\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\"1\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"})\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"                         .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"limit\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\"5000\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\")\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"                         .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"toArray\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"()\"}]]}]]}]}]}]\n"])</script><script>self.__next_f.push([1,"3b:[\"$\",\"p\",null,{\"children\":\"In fact, you can merge the two documents:\"}]\n"])</script><script>self.__next_f.push([1,"3c:[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#24292e\",\"color\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"{\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"    time\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\" : \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"ISODate\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"\\\"2015-09-02T09:10:09.032Z\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"),\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"    message\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\" : \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"'cpu is on fire!'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"    ipaddr\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\" : \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"'127.66.66.66'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"    hostname\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\" : \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9ECBFF\"},\"children\":\"'goofy.example.com'\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"}\"}]}]]}]}]}]\n"])</script><script>self.__next_f.push([1,"3d:[\"$\",\"p\",null,{\"children\":\"It would be used like this in the code:\"}]\n"])</script><script>self.__next_f.push([1,"3e:[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#24292e\",\"color\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"// receive log from monitoring program.\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"logmsg \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\" get_log_msg\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"();\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"log_message_here \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\" logmsg.msg;\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"log_ip \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\" logmsg.ipaddr;\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"// get timestamp\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"now \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\" Date\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"();\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"// find host's id for update\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"host_doc \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\" db.hosts.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"findOne\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"({ ipaddr: log_ip },{ _id: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\"1\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\" });\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"host_id \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\" host_doc._id;\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"// save denoramlized data\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"db.logmsg.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"save\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"({\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"    time : now,\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"    message : log_message_here,\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"    ipaddr : log_ip,\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"    host : host_id ) });\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"// Push the denoramlized data in 'one'\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"db.hosts.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#B392F0\"},\"children\":\"update\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"( {_id: host_id }, {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"    $push : {\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"      logmsgs : {\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"        $each:  [ { time : now, message : log_message_here } ],\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"        $sort:  { time : \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\"1\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\" },  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"// sort by time\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"        $slice: \"}],\"$L44\",\"$L45\",\"$L46\"]}],\"\\n\",\"$L47\",\"\\n\",\"$L48\",\"\\n\",\"$L49\"]}]}]}]\n"])</script><script>self.__next_f.push([1,"3f:[\"$\",\"h2\",null,{\"id\":\"6-rules-of-thumb\",\"children\":[[[\"$\",\"a\",\"link-6-rules-of-thumb\",{\"href\":\"#6-rules-of-thumb\",\"className\":\"anchor\"}]],\"6 Rules of Thumb\"]}]\n40:[\"$\",\"p\",null,{\"children\":\"Here are some \\\"rules of thumb\\\" to guide you through these innumerable (but not infinite) choices:\"}]\n"])</script><script>self.__next_f.push([1,"41:[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Favor embedding unless there is a compelling reason not to\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Needing to access an object on its own is a compelling reason not to embed it\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Arrays should not grow without bound. If there are more than a couple of hundred documents on the \\\"many\\\" side, don't embed them; if there are more than a few thousand documents on the \\\"many\\\" side, don't use an array of ObjectID references. High-cardinality arrays are a compelling reason not to embed.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Don't be afraid of application-level joins: if you index correctly and use the projection specifier then application-level joins are barely more expensive than server-side joins in a relational database.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Consider the write/read ratio when denormalizing. A field that will mostly be read and only seldom updated is a good candidate for denormalization: if you denormalize a field that is updated frequently then the extra work of finding and updating all the instances is likely to overwhelm the savings that you get from denormalizing.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"As always with MongoDB, how you model your data depends – entirely – on your particular application's data access patterns. You want to structure your data to match the ways that your application queries and updates it.\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"42:[\"$\",\"h2\",null,{\"id\":\"references\",\"children\":[[[\"$\",\"a\",\"link-references\",{\"href\":\"#references\",\"className\":\"anchor\"}]],\"References\"]}]\n43:[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://www.mongodb.com/blog/post/6-rules-of-thumb-for-mongodb-schema-design-part-1\",\"children\":\"6 Rules of Thumb for MongoDB Schema Design Part 1\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://www.mongodb.com/blog/post/6-rules-of-thumb-for-mongodb-schema-design-part-2\",\"children\":\"6 Rules of Thumb for MongoDB Schema Design Part 2\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://www.mongodb.com/blog/post/6-rules-of-thumb-for-mongodb-schema-design-part-3\",\"children\":\"6 Rules of Thumb for MongoDB Schema Design Part 3\"}]}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"44:[\"$\",\"span\",null,{\"style\":{\"color\":\"#F97583\"},\"children\":\"-\"}]\n45:[\"$\",\"span\",null,{\"style\":{\"color\":\"#79B8FF\"},\"children\":\"1000\"}]\n46:[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"          // get top 1000\"}]\n47:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"      }\"}]}]\n48:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"    }\"}]}]\n49:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#E1E4E8\"},\"children\":\"  });\"}]}]\n"])</script></body></html>